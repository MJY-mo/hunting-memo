/* style.css - v5 Compact & Enhanced UI */

/* ----------------------------------------------------------------------------
   1. テーマとフォントサイズの定義
---------------------------------------------------------------------------- */
:root {
    /* デフォルト (ライトテーマ) */
    --color-bg-primary: #f3f4f6;
    --color-bg-secondary: #ffffff;
    --color-text-primary: #1f2937;
    --color-text-secondary: #4b5563;
    --color-border: #d1d5db;
    --color-border-focus: rgb(59 130 246);
    --color-accent: rgb(37 99 235);
    
    /* ヘッダーの高さ */
    --header-height: 60px;
}

:root.theme-dark {
    --color-bg-primary: #1f2937;
    --color-bg-secondary: #374151;
    --color-text-primary: #f9fafb;
    --color-text-secondary: #d1d5db;
    --color-border: #4b5563;
    --color-border-focus: rgb(96 165 250);
    --color-accent: rgb(96 165 250);
}

:root.theme-sepia {
    --color-bg-primary: #fbf0e4;
    --color-bg-secondary: #ffffff;
    --color-text-primary: #5f4b32;
    --color-text-secondary: #7a5c3b;
    --color-border: #dcd0c0;
    --color-border-focus: #a98f71;
    --color-accent: #8c6b4a;
}
:root.theme-light-green { --color-accent: #15803d; }
:root.theme-light-blue { --color-accent: #0c4a6e; }

/* 文字サイズの基準値を設定 */
:root.font-size-xsmall { --font-size-base: 12px; }
:root.font-size-small { --font-size-base: 13px; }
:root.font-size-medium { --font-size-base: 15px; } /* 標準 */
:root.font-size-large { --font-size-base: 17px; }
:root.font-size-xlarge { --font-size-base: 20px; }


/* ----------------------------------------------------------------------------
   2. 基本スタイル & フォント適用
---------------------------------------------------------------------------- */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    overscroll-behavior-y: none;
    max-width: 640px;
    margin: 0 auto;
    background-color: var(--color-bg-primary);
    color: var(--color-text-primary);
    
    /* ★設定したベースサイズを適用 */
    font-size: var(--font-size-base);
}

/* フォーム要素やボタンもベースサイズに従う */
button, input, select, textarea, .btn, .tab-button, .form-input, .form-select {
    font-size: var(--font-size-base) !important;
}

/* ★タイトルのサイズ比率調整 (本文より大きく) */
h1 { font-size: calc(var(--font-size-base) * 1.4) !important; }
h2 { font-size: calc(var(--font-size-base) * 1.25) !important; }
h3 { font-size: calc(var(--font-size-base) * 1.15) !important; }

/* ★チェックリストは少し小さく */
.checklist-item-text {
    font-size: calc(var(--font-size-base) * 0.95) !important;
}

/* ----------------------------------------------------------------------------
   3. ヘッダー (修正: グリッドレイアウトで中央配置)
---------------------------------------------------------------------------- */
#header {
    background-color: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);
    height: var(--header-height);
}

/* コンテナを3カラムグリッドに変更して、真ん中を確実に中央にする */
#header .container {
    display: grid;
    grid-template-columns: 80px 1fr 80px; /* 左ボタン幅 - 中央可変 - 右アクション幅 */
    align-items: center;
    height: 100%;
    padding: 0 0.5rem;
}

#headerTitle {
    color: var(--color-text-primary);
    font-weight: 800;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

/* ★戻るボタン: 大きく分かりやすく */
#backButton {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 38px;
    background-color: var(--color-bg-primary); /* 背景色追加 */
    color: var(--color-accent);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-weight: 700;
    font-size: calc(var(--font-size-base) * 0.9) !important;
    cursor: pointer;
    text-align: center;
    padding: 0;
}
#backButton:active {
    background-color: #e5e7eb;
}
#backButton i { margin-right: 4px; } /* アイコンがあれば */

/* ----------------------------------------------------------------------------
   4. カード & タイル (修正: コンパクト化)
---------------------------------------------------------------------------- */
.card, .trap-card, .animal-card {
    background-color: var(--color-bg-secondary);
    border: 1px solid var(--color-border); /* 境界線を明確に */
    border-radius: 6px; /* 丸みを少し減らす */
    
    /* ★余白を狭くする */
    padding: 0.5rem 0.6rem !important; 
    margin-bottom: 0.4rem !important; /* カード間の距離を詰める */
    
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

/* カード内の行間も詰める */
.trap-card h3, .animal-name {
    margin-bottom: 0.1rem;
    line-height: 1.3;
}
.trap-card p {
    margin-bottom: 0;
    line-height: 1.3;
}

/* 画像プレビュー */
.photo-preview {
    width: 100%; height: 7rem; /* 少し高さを抑える */
    border: 2px dashed var(--color-border);
    border-radius: 0.375rem;
    background-color: var(--color-bg-primary);
    display: flex; align-items: center; justify-content: center;
    position: relative;
    overflow: hidden;
}
.photo-preview img { width: 100%; height: 100%; object-fit: contain; }

/* ----------------------------------------------------------------------------
   5. タブ & サブタブ (修正: 選択状態の可視化)
---------------------------------------------------------------------------- */
/* 下部固定ナビ */
nav.bg-white {
    background-color: var(--color-bg-secondary);
    border-top: 1px solid var(--color-border);
    padding-bottom: env(safe-area-inset-bottom); /* iPhone X等対応 */
    height: 60px;
}
.tab-button {
    color: var(--color-text-secondary);
}
.tab-active {
    color: var(--color-accent);
    font-weight: 700;
    background-color: rgba(0,0,0,0.03); /* アクティブ時に薄い背景 */
}

/* ★ページ内サブタブ（設置中/過去、チェック/編集など）のデザイン改善 */
.sub-tab-container {
    display: flex;
    background-color: var(--color-border); /* 背景を枠線の色に */
    padding: 2px;
    border-radius: 6px;
    margin-bottom: 0.75rem;
}
.sub-tab-button {
    flex: 1;
    padding: 6px 4px;
    text-align: center;
    border-radius: 4px;
    font-weight: 600;
    font-size: calc(var(--font-size-base) * 0.95);
    cursor: pointer;
    border: none;
}
/* アクティブなサブタブ */
.sub-tab-active {
    background-color: var(--color-bg-secondary);
    color: var(--color-accent);
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
/* 非アクティブなサブタブ */
.sub-tab-inactive {
    background-color: transparent;
    color: var(--color-text-secondary);
    opacity: 0.8;
}

/* ----------------------------------------------------------------------------
   6. 動物リスト (修正: コンパクト化)
---------------------------------------------------------------------------- */
.animal-card {
    display: flex; align-items: center;
    padding: 0.4rem !important; /* 狭く */
}
.animal-thumb-container {
    width: 45px; height: 45px; /* サムネイルを小さく */
    margin-right: 0.75rem;
    flex-shrink: 0;
    border-radius: 4px;
    overflow: hidden;
    background-color: #e5e7eb;
}
.animal-thumb { width: 100%; height: 100%; object-fit: cover; }
.animal-info { flex-grow: 1; min-width: 0; }
.animal-header { display: flex; align-items: center; margin-bottom: 2px; }

/* バッジ類も小さく */
.badge {
    padding: 1px 4px;
    font-size: 0.75em;
    border-radius: 3px;
    margin-right: 2px;
}

/* ----------------------------------------------------------------------------
   7. フォーム
---------------------------------------------------------------------------- */
.form-group { margin-bottom: 0.75rem; }
.form-label { margin-bottom: 0.2rem; font-weight: 600; color: var(--color-text-secondary); }
.form-input, .form-select, textarea {
    padding: 0.4rem 0.5rem; /* 内側を少し狭く */
}
.btn {
    padding: 0.5rem 1rem;
    font-weight: 600;
    border-radius: 6px;
}

/* テーマオーバーライド用 */
html.theme-sepia .sub-tab-container, html.theme-light-green .sub-tab-container, html.theme-light-blue .sub-tab-container {
    background-color: rgba(0,0,0,0.1);
}